<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Messenger Pro Chat v4</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
  *{margin:0;padding:0;box-sizing:border-box;}
  body {
    font-family:'Poppins',sans-serif;
    background:#fff;
    color:#000;
    display:flex;
    flex-direction:column;
    height:100vh;
    overflow:hidden;
  }
  body.dark {background:#111;color:#f5f5f5;}
  header {
    background:#0084ff;
    color:#fff;
    padding:10px 15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .toggle {background:none;border:none;color:white;font-size:18px;cursor:pointer;}
  .chat-box {
    flex:1;
    overflow-y:auto;
    padding:10px;
    display:flex;
    flex-direction:column;
    scroll-behavior:smooth;
  }

  /* ðŸ”¹ Message alignment */
  .message {
    display:flex;
    align-items:flex-end;
    margin:6px 0;
  }
  .left {justify-content:flex-start;}
  .right {justify-content:flex-end;}

  .message img.profile {
    width:35px;
    height:35px;
    border-radius:50%;
    margin:0 6px;
  }

  .bubble {
    max-width:70%;
    padding:10px;
    border-radius:16px;
    word-wrap:break-word;
  }

  /* ðŸ”¹ Admin message (Right Side - Blue) */
  .admin .bubble {
    background:#0084ff;
    color:#fff;
    border-bottom-right-radius:4px;
  }

  /* ðŸ”¹ User message (Left Side - Gray) */
  .user .bubble {
    background:#e4e6eb;
    color:#000;
    border-bottom-left-radius:4px;
  }

  body.dark .user .bubble {background:#333;color:#f5f5f5;}
  body.dark .admin .bubble {background:#0064d1;}

  .verified {
    width:14px;
    height:14px;
    margin-left:4px;
    vertical-align:middle;
    border-radius:50%;
  }

  .seen-status {
    font-size:11px;
    color:#777;
    text-align:right;
    margin-top:2px;
  }

  footer {
    background:#f0f2f5;
    padding:8px;
    display:flex;
    align-items:center;
    gap:8px;
    position:fixed;
    bottom:0;
    left:0;
    right:0;
  }
  body.dark footer {background:#222;}
  footer input {
    flex:1;
    padding:10px;
    border:none;
    border-radius:20px;
    background:#fff;
    outline:none;
  }
  body.dark footer input {background:#333;color:#fff;}
  footer button {background:none;border:none;cursor:pointer;}
  footer img.icon {width:26px;height:26px;}
</style>
</head>
<body>

<header>
  <span>Messenger Chat</span>
  <button id="toggleMode" class="toggle">ðŸŒ™</button>
</header>

<div class="chat-box" id="chatBox"></div>

<footer>
  <input type="text" id="messageInput" placeholder="Message...">
  <button id="sendBtn"><img src="https://cdn-icons-png.flaticon.com/512/3682/3682321.png" class="icon"></button>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAeC_qcXhUeXBeGDSPr-ODJMWnG8ykD5B4",
    authDomain: "csm-bolg-site.firebaseapp.com",
    projectId: "csm-bolg-site",
    storageBucket: "csm-bolg-site.appspot.com",
    messagingSenderId: "931917499515",
    appId: "1:931917499515:web:dc9890e7e990e55d7e66de"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  const ADMIN_EMAIL = "csmmohasinalam@gmail.com";
  const VERIFIED_BADGE = "https://dl8.wapkizfile.info/download/c4275ed00b49e8d2f586ffbd4dc6c25f/csm-mohasin-alam+wapkizs+com/2-jpg-(csm-mohasin-alam.wapkizs.com).jpg";

  const chatBox = document.getElementById("chatBox");
  const input = document.getElementById("messageInput");
  const sendBtn = document.getElementById("sendBtn");
  const toggleMode = document.getElementById("toggleMode");

  // ðŸŒ™ Dark Mode
  toggleMode.onclick = () => {
    document.body.classList.toggle("dark");
    toggleMode.textContent = document.body.classList.contains("dark") ? "â˜€ï¸" : "ðŸŒ™";
  };

  // ðŸ‘¤ Login system
  onAuthStateChanged(auth, async user => {
    if (!user) await signInWithPopup(auth, provider);
    else loadMessages(user);
  });

  // âœ‰ï¸ Send message
  sendBtn.onclick = () => {
    if (input.value.trim()) {
      sendMessage(input.value);
      input.value = "";
    }
  };

  async function sendMessage(content) {
    const user = auth.currentUser;
    if (!user) return;
    await addDoc(collection(db, "messages"), {
      name: user.displayName,
      email: user.email,
      content,
      time: serverTimestamp()
    });
  }

  function loadMessages(user) {
    const q = query(collection(db, "messages"), orderBy("time"));
    onSnapshot(q, snapshot => {
      chatBox.innerHTML = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const isAdmin = data.email === ADMIN_EMAIL;
        const isMine = data.email === user.email;

        const msgDiv = document.createElement("div");
        msgDiv.classList.add("message");

        // Admin â†’ Right Side | User â†’ Left Side
        if (isAdmin) {
          msgDiv.classList.add("admin", "right");
        } else {
          msgDiv.classList.add("user", "left");
        }

        const profile = document.createElement("img");
        profile.src = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
        profile.className = "profile";

        const bubble = document.createElement("div");
        bubble.className = "bubble";
        bubble.textContent = data.content;

        if (isAdmin) {
          bubble.innerHTML += ` <img src="${VERIFIED_BADGE}" class="verified">`;
        }

        // Layout: left = profile first, right = bubble first
        if (isAdmin) {
          msgDiv.appendChild(bubble);
          msgDiv.appendChild(profile);
        } else {
          msgDiv.appendChild(profile);
          msgDiv.appendChild(bubble);
        }

        chatBox.appendChild(msgDiv);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    });
  }
</script>
</body>
</html>
